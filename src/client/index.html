<!DOCTYPE html>
<html>
<head>
	<title>Report on Trends</title>
	
	<meta name=description content="">
	<meta charset=utf-8>
	<meta name=viewport content="width=device-width, initial-scale=1">

	<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.0.0/css/bootstrap.min.css">
	<script src="https://d3js.org/d3.v5.min.js"></script>

	<style type="text/css">
		div{
			white-space: nowrap;
		}

		.card{
			padding: 2em;
		}
	</style>
</head>
<body>
	<header class="jumbotron">
		<h1>Data</h1>
	</header>
	<main class="container mx-4 px-4">
		<div id="a1" class="card"></div>
		<div id="a2" class="card"></div>
		<div id="a3" class="card"></div>
		<div id="a4" class="card"></div>
	</main>

	<script type="text/javascript">
		const t = d3.transition()
			.duration(7000);

		Promise.all([
			fetch('/api/colors')
			.then(blob => blob.json()),
			fetch('/api/trends')
			.then(blob => blob.json())
			.then(data => data.slice(0, 10))
		])
		.then(res =>{
			let [colors, data] = res;
			const keys = Object.keys(data[0]);
			console.log(colors, data, keys);

			const barHeight = 20;
			const barX = d3.scaleLinear()
				.domain([0, data.length * barHeight * 4])
				.range([0, data.reduce((t, i)=> Math.max(t, i.vowels),0)*100]);
			const barY = d3.scaleLinear();

			console.log('barX', barX);

			d3.select('#a2')
				.append('svg')
				.selectAll('g')
				.data(data)
				.enter()
				.append('g')
				.attr('transform', function(d, i){ return `translate(0, ${barX(i)})`})
				.selectAll('rect')
				.data(function(data){
					return ['vowels', 'caps', 'extras', 'nums'].map(function(key){return {key:key, val: data[key]} });
				})
				.enter()
				.append('rect')
				.attr('x', function(d, i){return barHeight*i})
				.attr('height', function(d){return d.val + 'px'})
				.attr('width', barHeight + 'px')
				.attr('fill', colors[0][0])
				.text(function(d){return d.key});


			////////////////////////////////////////////////////////////
			d3.select('#a1')
				.selectAll('div')
				.data(data.slice(0, 10))
				.enter()
				.append('div')
				.style('width', function(d){return d.text.length *10 + 'px'})
				.style('background', colors[0][1])

				.append('div')
				.style('width', function(d){return d.vowels * 10 + 'px'})
				.style('background', colors[0][0])
				.text(function(d){return d.text})
				.transition(t)
				.style('background', colors[0][1]);
		});
	</script>
</body>
</html>